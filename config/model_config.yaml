# EPCID Model Configuration
# Machine Learning Models for Pediatric Risk Assessment

version: "1.0.0"

# Model Registry
models:
  # Tabular Risk Model (Baseline)
  tabular_risk_model:
    name: "pediatric_risk_xgboost"
    type: "gradient_boosted"
    framework: "xgboost"
    version: "1.0.0"
    features:
      demographic:
        - age_months
        - weight_percentile
        - height_percentile
        - sex
      vital_signs:
        - temperature_celsius
        - heart_rate_bpm
        - respiratory_rate
        - oxygen_saturation
        - blood_pressure_systolic
        - blood_pressure_diastolic
      symptoms:
        - symptom_count
        - symptom_severity_avg
        - symptom_duration_hours
        - fever_present
        - respiratory_symptoms
        - gi_symptoms
        - neurological_symptoms
      derived:
        - weight_velocity_7d
        - fever_persistence_hours
        - symptom_trend_slope
    hyperparameters:
      n_estimators: 500
      max_depth: 6
      learning_rate: 0.05
      subsample: 0.8
      colsample_bytree: 0.8
      min_child_weight: 3
      reg_alpha: 0.1
      reg_lambda: 1.0
    calibration:
      method: "isotonic"
      cv_folds: 5
    thresholds:
      critical: 0.85
      high: 0.65
      moderate: 0.35
      low: 0.0

  # Time Series Model
  temporal_transformer:
    name: "pediatric_temporal_encoder"
    type: "transformer"
    framework: "pytorch"
    version: "1.0.0"
    architecture:
      input_dim: 32
      hidden_dim: 128
      num_layers: 4
      num_heads: 8
      dropout: 0.1
      max_seq_length: 168  # 7 days of hourly data
    features:
      continuous:
        - temperature
        - heart_rate
        - respiratory_rate
        - oxygen_saturation
        - activity_level
      categorical:
        - symptom_present
        - medication_taken
        - meal_eaten
    training:
      batch_size: 32
      learning_rate: 0.0001
      warmup_steps: 1000
      max_epochs: 100
      early_stopping_patience: 10
    output:
      type: "risk_probability"
      confidence_interval: true

  # Vision Model (Rash/Skin Analysis)
  vision_model:
    name: "pediatric_dermatology_vit"
    type: "vision_transformer"
    framework: "pytorch"
    version: "1.0.0"
    architecture:
      backbone: "vit_base_patch16_224"
      pretrained: true
      num_classes: 15
      fine_tuned_layers: 4
    image_processing:
      input_size: 224
      normalize_mean: [0.485, 0.456, 0.406]
      normalize_std: [0.229, 0.224, 0.225]
      augmentations:
        - random_horizontal_flip
        - color_jitter
        - random_rotation_15
    output_classes:
      - normal_skin
      - viral_rash
      - bacterial_infection
      - allergic_reaction
      - eczema
      - insect_bite
      - petechiae
      - jaundice
      - pallor
      - cyanosis
      - bruising
      - swelling
      - wound
      - burns
      - other

  # Audio Model (Cough/Breathing Analysis)
  audio_model:
    name: "pediatric_respiratory_audio"
    type: "audio_cnn"
    framework: "pytorch"
    version: "1.0.0"
    architecture:
      backbone: "efficientnet_b0"
      input_channels: 1
      num_classes: 8
    audio_processing:
      sample_rate: 16000
      duration_seconds: 5
      n_mels: 128
      n_fft: 2048
      hop_length: 512
      normalize: true
    output_classes:
      - normal_breathing
      - wheezing
      - stridor
      - crackles
      - barking_cough
      - wet_cough
      - dry_cough
      - labored_breathing

# Ensemble Configuration
ensemble:
  strategy: "weighted_average"
  weights:
    tabular: 0.35
    temporal: 0.30
    vision: 0.20
    audio: 0.15
  fusion_method: "late_fusion"
  require_calibration: true

# Uncertainty Quantification
uncertainty:
  method: "conformal_prediction"
  coverage_target: 0.90
  calibration_set_size: 0.15
  adaptive_bands: true

# Training Configuration
training:
  data:
    train_split: 0.7
    val_split: 0.15
    test_split: 0.15
    stratify_by: "risk_tier"
  optimization:
    loss_function: "focal_loss"
    focal_gamma: 2.0
    class_weights:
      CRITICAL: 4.0
      HIGH: 2.0
      MODERATE: 1.0
      LOW: 0.5
  regularization:
    l2_weight_decay: 0.01
    dropout: 0.2
    label_smoothing: 0.1

# Evaluation Metrics
evaluation:
  primary_metric: "sensitivity_critical"
  metrics:
    - sensitivity
    - specificity
    - precision
    - recall
    - f1_score
    - auroc
    - auprc
    - brier_score
    - calibration_error
    - negative_predictive_value
  fairness_metrics:
    - equalized_odds
    - demographic_parity
    - calibration_by_group
  demographic_groups:
    - age_group
    - sex
    - ethnicity

# Model Serving
serving:
  framework: "fastapi"
  batch_inference: true
  max_batch_size: 32
  timeout_ms: 5000
  fallback_to_rules: true
